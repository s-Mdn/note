<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>composite</title>
</head>
<body>
    <!-- <script>
        (function(){
            console.log('回顾宏命令');
            var closeDoorCommand = { 
                execute: function(){ 
                    console.log( '关门' ); 
                } 
            }; 
            var openPcCommand = { 
                execute: function(){ 
                    console.log( '开电脑' ); 
                } 
            }; 
            var openQQCommand = { 
                execute: function(){ 
                    console.log( '登录 QQ' ); 
                } 
            };
            var MacroCommand = function() {
                return {
                    commandsList: [],
                    add: function( command ) {
                        this.commandsList.push( command )
                    },
                    execute: function(){
                        for( var i=0, command; command=this.commandsList[i++]; ) {
                            command.execute()
                        }
                    }
                }
            }
            var macroCommand = MacroCommand();
            macroCommand.add( closeDoorCommand );
            macroCommand.add( openPcCommand ); 
            macroCommand.add( openQQCommand );

            macroCommand.execute();
        })();
    </script> -->
    <button id="button">按我</button>
    <!-- <script>
        (function(){
            console.log('更强大的宏命令')
            var MacroCommand = function(){
                return {
                    commandsList: [],
                    add: function( command ) {
                        this.commandsList.push( command )
                    },
                    execute: function(){
                        for( var i=0, command; command=this.commandsList[i++]; ) {
                            console.log(command)
                            command.execute()
                        }
                    }
                }
            }
            
            /**家里的电视和音响是连接在一起的，所以可以用一个宏命令来组合打开电视和打开音响的命令*/
            var openTvCommand = {
                execute: function(){
                    console.log( '打开电视' );
                }
            }
            var openSoundCommand = {
                execute: function(){
                    console.log( '打开音响' );
                }
            }
            var macroCommand1 = MacroCommand();
            macroCommand1.add( openTvCommand );
            macroCommand1.add( openSoundCommand );

            /*********关门、打开电脑和打登录 QQ 的命令****************/
            var closeDoorCommand = {
                execute: function(){
                    console.log( '关门' );
                }
            }
            var openPcCommand = {
                execute: function(){
                    console.log( '开电脑' );
                }
            }
            var openQQCommand = {
                execute: function(){
                    console.log( '登录 QQ' );
                }
            }
            var macroCommand2 = MacroCommand();
            macroCommand2.add( closeDoorCommand );
            macroCommand2.add( openPcCommand );
            macroCommand2.add( openQQCommand );

            /*********现在把所有的命令组合成一个“超级命令”**********/
            var macroCommand = MacroCommand();
            // var openAcCommand = { 
            //     execute: function(){ 
            //         console.log( '打开空调' ); 
            //     } 
            // };
            // macroCommand.add( openAcCommand );
            macroCommand.add( macroCommand1 );
            macroCommand.add( macroCommand2 );

            /*********最后给遥控器绑定“超级命令”**********/
            var setCommand = (function( command ){
                document.getElementById( 'button' ).onclick = function(){
                    command.execute();
                }
            })( macroCommand )
        })();
    </script> -->
    <script>
        console.log('透明性带来的安全问题')
        var MacroCommand = function() {
            return {
                commandsList: [],
                add: function( command ) {
                    this.commandsList.push( command )
                },
                execute:function() {
                    for( var i = 0, command; command = this.commandsList[i++]; ) {
                        command/execute()
                    }
                }
            }
        }
        var openTvCommand = { 
            execute: function() {
                console.log('打开电视')
            },
            add: function() {
                throw new Error('叶子对象不能添加子节点')
            }
        }
        var macroCommand = MacroCommand();
        macroCommand.add( openTvCommand )
        // openTvCommand.add( macroCommand )
    </script>

    <script>
        // (function() {
        //     console.log('组合模式的例子——扫描文件夹');
        //     // 定义文件夹 Folder 和文件 File 两个类
        //     /******************************* Folder ******************************/
        //     var Folder = function( name ){
        //         this.name = name;
        //         this.files = [];
        //     }
        //     Folder.prototype.add = function( file ){
        //         this.files.push( file );
        //     }
        //     Folder.prototype.scan = function(){
        //         console.log( '开始扫描文件夹: ' + this.name );
        //         for ( var i = 0, file, files = this.files; file = files[ i++ ]; ){
        //             file.scan();
        //         }
        //     }

        //     /******************************* File ******************************/
        //     var File = function( name ){
        //         this.name = name;
        //     }
        //     File.prototype.add = function(){
        //         throw new Error( '文件下面不能再添加文件' );
        //     }
        //     File.prototype.scan = function(){
        //         console.log( '开始扫描文件: ' + this.name );
        //     }

        //     // 创建一些文件夹和文件对象， 并且让它们组合成一棵树
        //     var folder = new Folder( '学习资料' );
            
        //     var folder1 = new Folder( 'JavaScript' );
        //     var folder2 = new Folder ( 'jQuery' );
        //     var file3 = new File( '重构与模式' );

        //     var file1 = new File( 'JavaScript 设计模式与开发实践' ); 
        //     var file2 = new File( '精通 jQuery' );
            
        //     folder.add( folder1 );
        //     folder.add( folder2 );
        //     folder.add( file3 );
            
        //     folder1.add( file1 );
        //     folder2.add( file2 );
            
        //     // 文件和文件夹都复制到树中
        //     var folder3 = new Folder( 'Nodejs' );
        //     var file4 = new File( '深入浅出 Node.js' );
        //     folder3.add( file4 );

        //     var file5 = new File( 'JavaScript 语言精髓与编程实践' );
        //     // 文件都添加到原有的树中：
        //     folder.add( folder3 );
        //     folder.add( file5 );
        //     // console.log(folder)
        //     // folder.scan();
        // })();
    </script>
    <script>
        
        (function() {
            console.log('引用父对象(改写)')
            var Folder = function( name ){
                this.name = name;
                this.files = [];
                this.parent = null; //增加 this.parent 属性
            }
            Folder.prototype.add = function( file ){
                file.parent = this; //设置父对象
                this.files.push( file );
            }
            Folder.prototype.scan = function(){
                console.log( '开始扫描文件夹: ' + this.name );
                for ( var i = 0, file, files = this.files; file = files[ i++ ]; ){
                    file.scan();
                }
            }
            // 增加 Folder.prototype.remove 方法，表示移除该文件夹：
            Folder.prototype.remove = function(){
                if ( !this.parent ){ //根节点或者树外的游离节点
                    return;
                }
                for ( var files = this.parent.files, l = files.length - 1; l >=0; l-- ){
                    var file = files[ l ];
                    if ( file === this ){
                        files.splice( l, 1 ); 
                    }
                }
            }

            var File = function( name ){
                this.name = name;
                this.parent = null;
            }
            File.prototype.add = function(){ 
                throw new Error( '不能添加在文件下面' ); 
            };
            File.prototype.scan = function(){
                console.log( '开始扫描文件: ' + this.name );
            }
            File.prototype.remove = function(){
                if ( !this.parent ){ //根节点或者树外的游离节点
                    return;
                }
                for ( var files = this.parent.files, l = files.length - 1; l >=0; l-- ){
                    var file = files[ l ];
                    if ( file === this ){
                        files.splice( l, 1 );
                    }
                }
            }
            // 面测试移除文件功能
            var folder = new Folder( '学习资料' );
            var folder1 = new Folder( 'JavaScript' );
            var file1 = new Folder ( '深入浅出 Node.js' );

            // folder1.add( new File( 'JavaScript 设计模式与开发实践' ) );
            folder.add( folder1 ); 
            folder.add( file1 );

            console.log( folder )
        })()
    </script>
</body>
</html>